#!/usr/bin/env bash

TGT="${1}"
shift

[[ -z ${TGT} ]] && { echo "provide the ssh alias for target machine"; exit 1; }

NOW="$(date +%Y%m%d_%H%M%S)"

ssh ${TGT} mv /etc/xrd.cf.fst /etc/xrd.cf.fst.${NOW}
scp /etc/xrd.cf.fst ${TGT}:/etc/

cp /etc/sysconfig/eos_env /tmp/eos_env
sed --follow-symlinks -i "/^XRD_ROLES=/s/.*/XRD_ROLES=\"fst\"/" /tmp/eos_env
ssh ${TGT} mv /etc/sysconfig/eos_env /etc/sysconfig/eos_env.${NOW}
scp /tmp/eos_env ${TGT}:/etc/sysconfig/eos_env
rm -rf /tmp/eos_env

scp /etc/eos.keytab ${TGT}:/etc/

ssh ${TGT} "chown -R daemon:daemon /storage*"
echo "now run on the target machine: systemctl restart eos@fst "

